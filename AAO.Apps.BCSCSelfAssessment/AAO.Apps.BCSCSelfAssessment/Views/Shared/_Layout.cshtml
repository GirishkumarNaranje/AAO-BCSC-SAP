@* for redirecting after timeout*@
@*@{string returnSiteUrl = System.Configuration.ConfigurationManager.AppSettings["SSO_URL"] + System.Configuration.ConfigurationManager.AppSettings["RETURN_SITE_URL"];}*@

<!DOCTYPE html>
<html>
<head>

    <!-- Google tag (gtag.js) -->
    @*<script async src=https://www.googletagmanager.com/gtag/js?id =G-PH0S9G463P></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            } gtag('js', new Date());
            gtag('config', 'G-PH0S9G463P');
        </script>*@
    <!-- Google tag (gtag.js) -->

    <!-- Microsoft Clarity code (on 17Apr24)-->
    @*<script type="text/javascript">
            (function (c, l, a, r, i, t, y) {
                c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
                t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
                y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
            })(window, document, "clarity", "script", "9gh04v8zxz");
        </script>*@
    <!-- Microsoft Clarity code -->

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>@ViewBag.Title  AAO | BCSC Self Assessment Program</title>

    @*@Styles.Render("~/Content/css")*@

    <script src="~/Scripts/modernizr-2.6.2.js"></script>
    @*<script src="~/Scripts/jquery-1.10.2.js"></script>*@
    <script src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script src="~/Scripts/jquery.validate.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/fonts/font-awesome/css/font-awesome.min.css" rel="stylesheet" />

    <link href="~/Content/daterangepicker.css" rel="stylesheet" />
    <script src="~/Scripts/daterangepicker.js"></script>
    <link href="~/Content/DataTables/css/buttons.dataTables.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/DataTables/css/dataTables.bootstrap.min.css" rel="stylesheet" />
    <script src="~/Scripts/jquery.bootstrap-responsive-tabs.js"></script>
    <script src="~/Scripts/DataTables/jquery.dataTables.min.js"></script>
    <script src="~/Scripts/DataTables/dataTables.bootstrap.js"></script>
    <link href="~/Content/bootstrap-responsive-tabs.css" rel="stylesheet" />
    <script src="~/Scripts/DataTables/dataTables.responsive.min.js"></script>
    <link href="~/Content/DataTables/css/responsive.dataTables.min.css" rel="stylesheet" />
    <link href="~/Content/custom.css" rel="stylesheet" />
    <link href="~/Content/toast-messages.css" rel="stylesheet" />
    <script src="~/Scripts/toast-message.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.43/moment-timezone-with-data.min.js"></script>
    
    @Scripts.Render("~/bundles/modernizr")

    <!--Render _keepAlive.cshtml file fro 20 min check-->
    @if (Request.IsAuthenticated)
    {
        @Html.Partial("~/Views/Shared/_KeepAlive.cshtml")
    }

</head>
<body>

    <!-- Google Tag Manager (noscript) -->
    <!--
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T94L8X6"
                height="0" width="0" style="display:none;visibility:hidden" title="hhsgoogletagmanager"></iframe>
    </noscript>
    -->
    <!-- End Google Tag Manager (noscript) -->

    <div id="pageMessages"></div>
    <header>
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->

                <div class="navbar-header header">

                    <div class="col-lg-12 col-xs-10">
                        @*<a class="navbar-brand" href="#">
                                <img src="~/Content/img/logo.png" class="img-responsive logo-size">
                            </a>*@

                        <a class="navbar-brand logo-size" href="#">

                        </a>

                    </div>

                    <div class="col-xs-2">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false" style="border: none;">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                    </div>
                    @if (System.Web.HttpContext.Current.User.Identity.IsAuthenticated)
                    {

                        if (User.IsInRole("A"))
                        {
                            @*@Html.ActionLink("MY Home", "Index", new { Controller = "AdminDashboard" }, new { @class = "navbar-brand" })*@
                        }
                        else
                        {
                            @*@Html.ActionLink("My Home", "Index", new { Controller = "Dashboard" }, new { @class = "navbar-brand" })*@
                        }
                    }

                </div>

                @if (User.IsInRole("U"))
                {
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="header-search" id="header-search-div">
                        <div class="input-group">
                            <input type="text" id="headersearch" search="searchbox" class="form-control" placeholder="Search">
                            <span class="input-group-btn">
                                <a id="searchButton" class="btn btn-primary" href="#" onclick="searchAAO()"><span class="icn-search"></span></a>
                            </span>
                        </div>

                    </div>
                }

                @if (User.IsInRole("U"))
                {
                    <div class="header-secondary-icons pull-left xs-padleft12">
                        <li class="pull-right ">
                            <a href="@Url.Content("~/Dashboard/HelpPage")" style="color: #8679a3;">
                                <i class="fa fa-question-circle"></i>  Help
                            </a>
                        </li>
                        @*<li id="about-drop" class="cursor-pointer" data-toggle="popover" data-container="body" data-placement="left" type="button" data-html="true">*@

                        <li class="nopadding">
                            <a href="@Url.Content("~/Dashboard/AboutPage")" style="color: #8679a3;">
                                <i class="fa fa-info-circle"></i> About
                            </a> &nbsp;
                        </li>
                    </div>

                }
                </ul>
            </div>
            </div><!-- /.container-fluid -->

            <div classs="col-md-12">

                <div class="collapse navbar-collapse LayoutMainTabs" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav main-menu">

                        @if (System.Web.HttpContext.Current.User.IsInRole("A"))
                        {
                            <li>@Html.ActionLink("BCSC Content Mapper", "Index", new { Controller = "BCSCMapper" }, new { @class = "OptIn-Padding" })</li>
                            @*<li>@Html.ActionLink("Import QAS Data", "ImportQASData", new { Controller = "AdminDashboard" })</li>*@
                            <li>@Html.ActionLink("Reports", "Index", new { Controller = "AggregateUserPerformance" }, new { @class = "OptIn-Padding" })</li>
                            <li>@Html.ActionLink("Question Performance", "Index", new { Controller = "AdminQuestionPerformance" }, new { @class = "OptIn-Padding" })</li>
                            <li>@Html.ActionLink("Utilization Reports", "Index", new { Controller = "UtilizationReports" }, new { @class = "OptIn-Padding" })</li>
                            <li>@Html.ActionLink("Opt-in", "Index", new { Controller = "OptInReports" }, new { @class = "OptIn-Padding" })</li>
                            <li>@Html.ActionLink("User View", "Index", new { Controller = "UserView" }, new { @class = "OptIn-Padding" })</li>
                            <li>@Html.ActionLink("Message Settings", "Index", new { Controller = "NotificationMessageSetting" }, new { @class = "OptIn-Padding" })</li>
                            @*<li><a href="#">Welcome Mr/Ms @User.Identity.Name.ToString()</a> </li>*@
                        }
                        @if (System.Web.HttpContext.Current.User.IsInRole("U"))
                        {
                            <li id="Dashboard">
                                <a href="@Url.Content("~/Dashboard/Index")">
                                    <i class="fa fa-tachometer text-center menu-icons"></i>
                                    Dashboard
                                </a>
                            </li>
                            <li class="space-rep-icon">
                                <a href="@Url.Content("~/SpacedRepetition/SRLanding")" id="spaceRep" style="clear:left" class="spaceRep-margin">


                                    @*<img id="spaceImg" src="\Content\img\GspaceRep.svg">*@
                                    <i class="fa fa-retweet text-center menu-icons" aria-hidden="true"></i>
                                    Spaced Repetition
                                </a>
                            </li>
                            <li>
                                <a href="@Url.Content("~/ExamManager/Index")">
                                    <i class="fa fa-file text-center menu-icons" style="color:#8679a3;"></i>
                                    Build Exam
                                </a>
                            </li>

                            <li>
                                <a href="@Url.Content("~/ExamHistory/Index")">
                                    <i class="fa fa-save text-center menu-icons"></i>
                                    Exam History
                                </a>
                            </li>
                            <li>
                                <a href="@Url.Content("~/AggregatePerformance/Index")">
                                    <i class="fa fa-line-chart text-center menu-icons"></i>
                                    Exam Reports
                                </a>
                            </li>
                            <li>
                                <a href="@Url.Content("~/CMECredit/CMEIndexPage")">
                                    <i class="fa fa-certificate text-center menu-icons"></i>
                                    CME Credits
                                </a>
                            </li>

                        }
                    </ul>
                    <ul class="nav navbar-nav navbar-right wc-lg">
                        <div class="username">
                            @if (System.Web.HttpContext.Current.User.Identity.IsAuthenticated)
                            {

                                string[] @Name = (@System.Web.HttpContext.Current.User.Identity.Name.Split('|'));
                            <li>
                                <span class="welcome-message">Welcome </span>@Name[1]
                            </li>
                            <li>
                                <a href="@Url.Content("~/Login/LogOffafterTimeOut")" class="welcome-message" @*onclick="Logout()"*@>    
                                    <i class="fa fa-sign-out"></i>Logout
                                </a>
                            </li>
                        }

                    </div>
                    </ul>
                </div>
            </nav>

        </header>



        <div class="container-fluid body-content">
            @RenderBody()
        </div>

        <footer class="martop30">
            <div class="container-fluid">

                <div class="col-lg-12 text-center xs-nopadding">
                    <div class="copyright-text">
                        &copy American Academy of Ophthalmology @DateTime.Now.Year
                    </div>
                </div>
                <div class="clearfix">
                </div>
            </div>
        </footer>
        <div id="about-popover" class="hide">
            <div class="col-lg-7">
                <p class="about-popover-content">
                    This program from the American Academy of Ophthalmology helps
                    Ophthalmology residents and practicing ophthalmologists assess their clinical and scientific
                    Knowledge efficiently and effectively.
                </p>
                <a href="~/Dashboard/AboutPage" class="font12">know more</a>
            </div>
            <div class="col-lg-5 nopadding about-popover-links">
                <li><a href="/Dashboard/AboutPage#aboutProgram">About the program</a></li>
                <li><a href="/Dashboard/AboutPage#authors">Authors</a></li>
                <li><a href="/Dashboard/AboutPage#cme">CME</a></li>
                <li><a href="/Dashboard/AboutPage#contact">Contact Us</a></li>
            </div>
        </div>
        <script src="~/Scripts/CommonScript/CommonScript.js"></script>

        <!-- Paste this snippet near the end of your _Layout.cshtml, before the closing </body> tag -->
        <!-- Make sure any other shared scripts (jquery/bootstrap/etc.) are above this block if page scripts depend on them -->
        <!-- Shared libs (local or CDN). Use local paths if you host them yourself -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.43/moment-timezone-with-data.min.js"></script>

        <!-- Small runtime helper: exposes getViewerTz() and indicates availability -->
        <script>
            (function () {
                window.__momentAvailable = (typeof moment !== 'undefined');
                window.__momentTzAvailable = window.__momentAvailable && typeof moment.tz === 'function' && Array.isArray(moment.tz.names) && moment.tz.names().length > 0;

                function getIntlTz() {
                    try {
                        var tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
                        if (tz) return tz;
                    } catch (e) { /* ignore */ }
                    return 'UTC';
                }

                window.getViewerTz = function () {
                    if (window.__momentTzAvailable) return moment.tz.guess();
                    return getIntlTz();
                };

                // Optional debug helper
                window.ensureMomentTz = function () {
                    return {
                        momentAvailable: !!window.__momentAvailable,
                        momentTzAvailable: !!window.__momentTzAvailable,
                        guessedTz: window.getViewerTz()
                    };
                };
            })();
        </script>

        <!-- Allow pages to inject scripts that will run after the above libraries -->
        @RenderSection("scripts", required: false)

    </body>
</html>
<script>
 //for redirecting after timeout
@*    var RETURN_SITE_URL = "@returnSiteUrl";
    window.onload = initScript(RETURN_SITE_URL);*@


    //window.setInterval(keepAlive, 236000);
    //window.setInterval(function () {
    //    alert('Referesh');
    //    keepAlive();
    //}, 60 * 1000); // 60 * 1000 milsec

    //function keepAlive() {
    //    $.ajax(
    //    {
    //        url: "/basecontroller/checkSession",
    //        cache: false,
    //        success: function () { }
    //    }
    //    );
    //}
    //session end

    //session end
    //$(document).ready(function () {
    //    debugger;
    //    setInterval(function () {
    //        checkSession();
    //    }, 10000);
    //});
    $(document).ajaxError(function (xhr, props) {
        if (props.status === 401) {
            /**/
            window.location.href = '/Login/SignOut';
        }
    });

    //Logout Function Called after Logout click
@*    function Logout() {
        //debugger;
          $.ajax({
            type: "POST",
              url: "/Login/SignOutfromlogoutbutton",
              success: function (data) {
                  //debugger;
                  if (data.isSuccess) {
                      window.location.href = data.ssologout_Url;
                }
            }
        });
    }*@

    /**/

    //function checkSession() {
    //    debugger;
    //    $.ajax({
    //        type: "POST",
    //        url: "/Login/checkSession",
    //        success: function (data) {
    //            if (data == "True") {
    //                window.location.href = '/Login/SignOut';
    //            }
    //        }
    //    });
    //}


    function searchAAO() {
        let searchitem = $('#headersearch').val();
        if (searchitem.trim() != "") {
            window.location.href = '/SearchByExam/SearchByQuestions' + '?SearchTerm=' + searchitem.trim() + '&Filter=' + "All";
        }
    }

    $('#headersearch').keypress(function (e) {
        var key = e.which;
        if (key == 13)  // the enter key code
        {
            searchAAO();
            return false;
        }
    });


</script>
<style>



    a#spaceRep:hover > div > #spaceImg {
        content: url('/Content/img/spaceRepition.svg');
    }

    a#spaceRep:active > div > #spaceImg {
        content: url('/Content/img/spaceRepition.svg');
    }

    a#spaceRep:visited > #spaceImg {
        content: url('/Content/img/spaceRepition.svg');
    }

    a#spaceRep:after > div > #spaceImg {
        content: url('/Content/img/spaceRepition.svg');
    }

    .addspaceRep {
        content: url('/Content/img/spaceRepition.svg');
    }

    .space-rep-icon.active img#spaceImg {
        content: url('/Content/img/spaceRepition.svg');
    }

    #spaceImg {
        width: 100%;
        height: 100%;
        color: #8679a3;
    }

    .divImage {
        display: block;
        text-align: center;
        width: 20px;
        height: 20px;
        margin: 0 auto;
    }

    #spaceRep {
        margin-top: 0px;
    }
</style>

<style>

    /* Email Autocomplete Styles */
    #emailSuggestions {
        position: absolute;
        background: white;
        border: 1px solid #ddd;
        border-top: none;
        max-height: 200px;
        overflow-y: auto;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        z-index: 1000;
    }

    .email-suggestion-item {
        padding: 8px 12px;
        cursor: pointer;
        border-bottom: 1px solid #f0f0f0;
        transition: background-color 0.2s ease;
    }

        .email-suggestion-item:last-child {
            border-bottom: none;
        }

        .email-suggestion-item:hover,
        .email-suggestion-item.selected {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .email-suggestion-item .email-address {
            font-size: 14px;
            color: #333;
        }

        .email-suggestion-item.selected .email-address {
            color: #1976d2;
            font-weight: 500;
        }

    .email-autocomplete {
        position: relative;
    }

    #EmailId:focus {
        border-color: #1976d2;
        box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
    }

    #sharedExamSearchButton {
        background-color: transparent !important;
        border: none !important;
    }

    .btn-group-custom {
        display: inline-flex;
        gap: 5px;
    }

    .hidden {
        display: none;
    }
</style>
<style>
    /* Shared Exam Search specific styles */
    .search-input-with-icon-container {
        position: relative;
    }

    .shared-exam-search-input {
        padding-right: 15px !important;
    }

    .shared-exam-search-icon-inside {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: #8679a3;
        z-index: 10;
        font-size: 16px;
        transition: color 0.3s ease;
        pointer-events: all;
    }

        .shared-exam-search-icon-inside:hover {
            color: #5a4d73;
        }

    #sharedExamSearchButton {
        display: none;
    }
</style>